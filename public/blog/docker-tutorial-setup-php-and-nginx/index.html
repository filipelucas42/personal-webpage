<html>
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <link rel="stylesheet" href="/new.css">
     <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161652863-2"></script>
     <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-161652863-2');
     </script>
	 <title>Docker Tutorial - Setup PHP and Nginx</title>
</head>
<body>
     <head>
    <nav>
        <a href="/">Home</a>
        /
        <a href="/blog">Blog</a>
        /
         <a href="/about">About</a>
    </nav>
</head>
		 <h2 id="docker-tutorial---setup-php-and-nginx">Docker Tutorial - Setup PHP and Nginx</h2>
<p>In this tutorial I will present the the basic docker commands and guide you trough a setup of PHP and Nginx as a simple exercise. Note that most of the times you will encounter this setup using docker-compose, however we will not use that as a way to practice the basics of docker cli.</p>
<p>Note that by default you need to use <code>sudo</code> to run a docker command.</p>
<p>First we need to download the two images from docker hub that will be used: nginx and php:</p>
<pre><code>docker pull nginx
docker pull php
</code></pre><p>Check your available images in your local machine:</p>
<pre><code>docker images
</code></pre><p>For purpose of organization lets create a folder to put all the files related with this setup:</p>
<pre><code>mkdir ~/nginx-php
mkdir ~/nginx-php/conf.d
mkdir ~/nginx-php/code
</code></pre><p>We can start by running the nginx image:</p>
<pre><code>docker run --name my-nginx -p 80:80 -d nginx
</code></pre><ul>
<li>-d: run in detach mode, otherwise you would get inside the running container shell</li>
<li>-p: expose port 80 of container and links it to localhost port 80, if you write instead <code>8080:80</code> for example the localhost port 8080 would redirect the traffic to port 80 inside the container</li>
<li>&ndash;name: gives a name to the container, if you do not give this option docker will generate a random name</li>
</ul>
<p>You can refer the container by it&rsquo;s ID or name, you can check the running containers with:</p>
<pre><code>docker container ls
</code></pre><p>With the nginx container running you can go to the browser and check you localport 80 by typing in the URL <code>localhost:80</code>, you can check that appears the default Nginx webpage.</p>
<p>Now lets stop the container and remove it so we can run it again with some more additional flags:</p>
<pre><code>docker stop my-nginx
docker rm my-nginx
</code></pre><p>Lets run the nginx image again with more two additional flags:</p>
<pre><code>docker run --name my-nginx -p 80:80 -v ~/nginx-php/conf.d:/etc/nginx/conf.d -v ~/nginx-php/code:/code -d nginx
</code></pre><ul>
<li>-v: it mounts a local diretory inside a container directory, is our case all files from <code>~/nginx-php/conf.d</code> are shared with the container inside /etc/nginx/conf.d</li>
</ul>
<p>Before start serving PHP files let&rsquo;s just serve a simple html file to check if in fact the nginx container is working. Inside <code>~/nginx-php/conf.d</code> create the file <code>app.conf</code> with the following content:</p>
<pre><code>server {
    index index.php index.html;
    server_name _;
    root /code;
}
</code></pre><p>Inside ~/nginx-php/code create the file index.html and write in it some text. Let&rsquo;s take this opportunity to enter inside container shell and check is the Nginx config is right. You can enter the shell container with this command:</p>
<pre><code>docker exec -ti my-nginx bash
</code></pre><p><code>docker exec</code> executes a command inside the container, in this case when need a bash shell, the <code>-t</code> option gives you a tty and <code>-i</code> puts you in interactive mode.</p>
<p>To check if the Nginx config is write type inside the container:</p>
<pre><code>nginx -t
</code></pre><p>If it gives an ok you cant exit the container with <code>CTRL+d</code> and reload it with the command:</p>
<pre><code>docker restart my-nginx
</code></pre><p>If you now go to the browser and type <code>localhost:80/index.html</code> it will show up the contents inside <code>~/nginx-php/code/index.html</code> that correspond inside the docker <code>/code/index.html</code>.</p>
<p>Let&rsquo;s now run the php container:</p>
<pre><code>docker run --name my-php -p 9000:9000 -v ~/nginx-php/code:/code -d php:fpm
</code></pre><p>Now inside <code>~/nginx-php/code</code> create the file index.php and write inside:</p>
<pre><code>&lt;?php
echo phpinfo();
</code></pre><p>Before we change the Nginx config we need to check what is the php container ip:</p>
<pre><code>docker inspect my-php
</code></pre><p>However this will give you a ton of information, to see just what we want run:</p>
<pre><code>docker inspect my-php | grep IPAddress
</code></pre><p>In my case the php container IP is 172.17.0.3</p>
<p>Now inside <code>~/nginx-php/conf.d/app.conf</code> write:</p>
<pre><code>server {
    index index.php index.html;
    server_name _;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    root /code;

    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass 172.17.0.3:9000;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }
}
</code></pre><p>Note that instead <code>fastcgi_pass 172.17.0.3:9000</code> you should put the IP of you php container that you got <code>fastcgi_pass &lt;you_php_container_ip&gt;:9000</code></p>
<p>Restart the Nginx container <code>docker restart my-nginx</code> and now if you go to the browser and type <code>localhost/index.php</code> it should show you the output of <code>phpinfo()</code> that you wrote in the <code>~/nginx-php/code/index.php</code> .</p>
<p>Besides knowing now a little bit more about docker you have now too a simple PHP development environment that supposedly you can run in any machine that has docker installed.</p>

     
</body>
</html>

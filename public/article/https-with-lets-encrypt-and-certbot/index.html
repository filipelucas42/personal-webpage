<html>
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <link rel="stylesheet" href="/new.css">
     <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161652863-2"></script>
     <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-161652863-2');
     </script>
	 <title>HTTPS with Let&#39;s Encrypt and Certbot</title>
</head>
<body>
     <head>
    <nav>
         <a href="/">Articles</a>
         /
         <a href="/about">About</a>
    </nav>
</head>
		 <h1 id="https-with-lets-encrypt-and-certbot">HTTPS with Let&rsquo;s Encrypt and Certbot</h1>
<p>HTTPS allows secure connections between browsers and web servers and if you transit sensitive information (like passwords for login) between your website and it&rsquo;s users having HTTPS is a must.</p>
<p>Nowdays due to <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> it&rsquo;s possible to obtain free certificates and enable HTTPS for your websites with no costs.</p>
<p>I will explain in two parts how to enable HTTPS for your websites:</p>
<ul>
<li>Obtain certificate</li>
<li>Install certificate (in this case it will be explain with nginx)</li>
</ul>
<h2 id="obtain-certificate">Obtain certificate</h2>
<p>It will be used <em>certbot</em> tool to make this process easier. If you are using linux it&rsquo;s likely that <em>certbot</em> is in your package manager, for Ubuntu and Debian distributions you can install with <em>sudo apt install certbot</em></p>
<p>After installation you can get a free certificate by running the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo certbot certonly --standalone -d example.com
</code></pre></div><p>Note if you have a webserver running (for example nginx) you need to disable it before running that command or you can run the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo certbot certonly --standalone -d example.com --pre-hook <span style="color:#e6db74">&#34;systemctl stop nginx.service&#34;</span> --post-hook <span style="color:#e6db74">&#34;systemctl start nginx.service&#34;</span>
</code></pre></div><p>After you run the command you should get a free certificate that it is stored in the following directory <code>/etc/letsencrypt/live/example.com</code>. In this directory there are two files you will need to install: <em>fullchain.pem</em> and <em>privkey.pem</em>.</p>
<p>In my case I got two certificates for each one of my two websites and so I run the following commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo certbot certonly --standalone -d www.filipelucas.com --pre-hook <span style="color:#e6db74">&#34;systemctl stop nginx.service&#34;</span> --post-hook <span style="color:#e6db74">&#34;systemctl start nginx.service&#34;</span>
sudo certbot certonly --standalone -d blog.filipelucas.com --pre-hook <span style="color:#e6db74">&#34;systemctl stop nginx.service&#34;</span> --post-hook <span style="color:#e6db74">&#34;systemctl start nginx.service&#34;</span>
</code></pre></div><p>My two certificates are in <code>/etc/letsencrypt/live/www.filipelucas.com</code> and <code>/etc/letsencrypt/live/blog.filipelucas.com</code>.</p>
<p>Note that you <strong>should</strong> do a backup of <code>/etc/letsencrypt/</code> folder.</p>
<p>Now that we have the certificate for the website we should use it with our webserver software that in my case is nginx.</p>
<h2 id="install-certificate-with-nginx">Install certificate with nginx</h2>
<p>To install the certificate you need to change the config of the nginx that are in <code>/etc/nginx/nginx.conf</code>, to know what to put there go to the following website <a href="https://ssl-config.mozilla.org/">https://ssl-config.mozilla.org/</a>, this site is done by Mozilla and it provides the right configuration for the HTTPS for you server, just select you webserver software (for instance nginx) and it&rsquo;s right version. To check the version of nginx run the following command <code>sudo nginx -v</code></p>
<p>As an example I will show my nginx config for HTTPS:</p>
<ul>
<li><a href="https://www.filipelucas.com">www.filipelucas.com</a>:</li>
</ul>
<pre><code>server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_certificate /etc/letsencrypt/live/www.filipelucas.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.filipelucas.com/privkey.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:MozSSL:10m;  # about 40000 sessions
    ssl_session_tickets off;

    # curl https://ssl-config.mozilla.org/ffdhe2048.txt &gt; /path/to/dhparam.pem
    #ssl_dhparam /path/to/dhparam.pem;

    # intermediate configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # HSTS (ngx_http_headers_module is required) (63072000 seconds)
    add_header Strict-Transport-Security &quot;max-age=63072000&quot; always;

    # OCSP stapling
    ssl_stapling on;
    ssl_stapling_verify on;

    # verify chain of trust of OCSP response using Root CA and Intermediate certs
    #ssl_trusted_certificate /path/to/root_CA_cert_plus_intermediates;

    # replace with the IP address of your resolver
    #resolver 127.0.0.1;
    server_name filipelucas.com www.filipelucas.com;
    root /var/www/html/personal;

    location / {
        index index.html;
    }
}
</code></pre><ul>
<li>(blog.filipelucas.com)(<a href="https://blog.filipelucas.com">https://blog.filipelucas.com</a>):</li>
</ul>
<pre><code>server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_certificate /etc/letsencrypt/live/blog.filipelucas.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/blog.filipelucas.com/privkey.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:MozSSL:10m;  # about 40000 sessions
    ssl_session_tickets off;

    # curl https://ssl-config.mozilla.org/ffdhe2048.txt &gt; /path/to/dhparam.pem
    #ssl_dhparam /path/to/dhparam.pem;

    # intermediate configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # HSTS (ngx_http_headers_module is required) (63072000 seconds)
    add_header Strict-Transport-Security &quot;max-age=63072000&quot; always;

    # OCSP stapling
    ssl_stapling on;
    ssl_stapling_verify on;

    # verify chain of trust of OCSP response using Root CA and Intermediate certs
    #ssl_trusted_certificate /path/to/root_CA_cert_plus_intermediates;

    # replace with the IP address of your resolver
    #resolver 127.0.0.1;
    server_name blog.filipelucas.com www.blog.filipelucas.com;
    location / {
        proxy_pass http://127.0.0.1:8081;
    }
}
</code></pre><p>To check it configs are right run <code>sudo nginx -t</code> and then reload the configs <code>sudo systemctl reload nginx</code>.</p>
<p>Note that the certificates are only valide for 90 days, after that time you can renew again.</p>

     
</body>
</html>
